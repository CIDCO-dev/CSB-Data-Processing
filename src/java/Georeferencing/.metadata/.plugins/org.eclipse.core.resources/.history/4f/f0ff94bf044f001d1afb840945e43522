package ca.cidco.csb;

import ca.cidco.csb.ppp.PppFile;
import ca.cidco.csb.surveydata.Position;
import java.io.IOException;


public class GnssQualifier {
	private boolean ersValid=false;
	private boolean wlrsValid=false;
	
	public GnssQualifier(){
	}
	
	public boolean isErsValid() {
		return ersValid;
	}

	public boolean isWlrsValid() {
		return wlrsValid;
	}

	public void validate(PppFile ppp) throws IOException, InterruptedException {

        double nsv_ppp = 6.0;
        double gdop_ppp = 3.5;
        double sdlat_ppp = 5.0;
        double sdlon_ppp = 5.0;
        double sdhgt_ppp = 0.5;
    	ersValid=true;
    	wlrsValid=true;
    	
		//Read POS file line by line

        for (Position pos : ppp.getPositions()) {
			
        	// if nsv, gdop, sdlat or sdlon are invalid, invalidate everything  and stop processing file
        	if (pos.getNsv()< nsv_ppp){
        		System.out.println("return false <nsv> " +pos.getNsv()+ "<" +nsv_ppp);
        		ersValid=false;
        		wlrsValid=false;
        		break;
        	}
        	if(pos.getGdop()> gdop_ppp){
        		System.out.println("return false <gdop> " +pos.getGdop()+ ">" +gdop_ppp);
        		ersValid=false;
        		wlrsValid=false;
        		break;
        	}
        	if (pos.getSdlat()> sdlat_ppp){
        		System.out.println("return false <sdlat> " +pos.getSdlat()+ ">" +sdlat_ppp);
        		ersValid=false;
        		wlrsValid=false;
        		break;
        	}
        	if (pos.getSdlon()> sdlon_ppp){
        		System.out.println("return false <sdlon> "+ pos.getSdlon()+ ">" +sdlon_ppp);
        		ersValid=false;
        		wlrsValid=false;
        		break;
        	}            		
        	// if gnss height invalid, invalidate ers only
        	if (pos.getSdhgt()> sdhgt_ppp){
        		System.out.println("return false <sdhgt> " + pos.getSdhgt()+">" +sdhgt_ppp);
        		ersValid=false;
        	}               				
        	
    	} 

            	
		System.out.println("GnssQualifier done");
	}
}