package ca.cidco.csb;

import ca.cidco.csb.georeference.ErsGeoreference;
import ca.cidco.csb.georeference.Georeference;
import ca.cidco.csb.ppp.NrcanPPP;
import ca.cidco.csb.ppp.PppFile;
import ca.cidco.csb.surveyplatform.hydroblock.Hydroblock20;
import ca.cidco.csb.utilities.Conversion;

public class Main {

	public static void main(String[] args) {
		//TODO: Testing CLI 
		
    	// ubx test if no cli args
//		String test1 = "/home/dominic/Bureau/ubx/2022.06.01_005418.ubx"; 	// Not Valid POS		Bella

//		String test7 = "/home/dominic/Bureau/ubx/2022.10.10_194410.ubx"; 	// Not Valid POS		Bella
//		String test8 = "/home/dominic/Bureau/ubx/2022.10.11_224413.ubx";  	// Valid 	 POS		Bella
		
		String test9ubx = "/home/dominic/Bureau/georef/2022.10.11_224413.ubx"; // Valid 	 POS		Bella
		String test9imu = "/home/dominic/Bureau/georef/2022.10.11_223416_imu.txt"; 
		String test9sonar = "/home/dominic/Bureau/georef/2022.10.11_223416_sonar.txt"; 
		String test9 = "/home/dominic/Bureau/georef/"; 
		String test1 = "/home/dominic/Bureau/georef/test/"; 
		String test2 = "/home/dominic/Bureau/georef/test2/"; 
		String test3 = "/home/dominic/Bureau/georef/test3/"; 
		
		
		//CLI args
/*		String gnssBinaryFile="";
		if (args.length > 0) {
		    try {
		    	gnssBinaryFile = new java.io.File(args[0]).getAbsolutePath();
		    } catch (Exception e) {
		        System.err.println("Argument " + args[0] + " must be an Binary File.");
		        System.exit(1);
		    }
		}
		//If no valid args, use test File 
		else {
			gnssBinaryFile = test8;
			System.err.println("No arg in CLI, processing this test file :"+gnssBinaryFile);
		}
*/		
		// test9 is dataPath with imu sonar and ubx files
		try {
			
			System.out.println(Conversion.convertDMStoDecimalDegree(342.12, 48.234 , 56.4567));
			Hydroblock20 hydro = new Hydroblock20();
			hydro.read(test9);
			
			
//			check depth			
			System.err.println("depths size :"+ hydro.getDepths().size());
			int depthsSize= hydro.getDepths().size();
			if (depthsSize>0) {
				System.out.print("hydro first depth : " +hydro.getDepths().get(0));
				System.out.println("hydro last depth : " +hydro.getDepths().get(depthsSize-1));
			}
			else {
				System.err.println("\n			depths ArrayList is empty \n");
			}
			
//			check attitudes			

			System.err.println("attitudes size :"+ hydro.getAttitudes().size());
			int attitudesSize= hydro.getAttitudes().size();
			if (attitudesSize>0) {
				System.out.print("hydro first attitude : " +hydro.getAttitudes().get(0));
				System.out.println("hydro last attitude : " +hydro.getAttitudes().get(attitudesSize-1));
			}
			else {
				System.err.println("\n			attitudes ArrayList is empty \n");
			}
			
//			check positions			

			System.err.println("positions size :"+ hydro.getPositions().size());
			int positionsSize= hydro.getPositions().size();
			if (positionsSize>0) {
				System.out.print("hydro first position : " +hydro.getPositions().get(0));
				System.out.println("hydro last position : " +hydro.getPositions().get(positionsSize-1));
			}

			else {
				System.err.println("\n			positions ArrayList is empty \n");
			}
			System.err.println("ERV valid? :"+ hydro.getGnss().isErsValid());
			System.err.println("WLRS valid? :"+ hydro.getGnss().isWlrsValid());

			
			ErsGeoreference georef = new ErsGeoreference();
			System.out.println(georef.getClass());
			georef.process(hydro.getPositions(), hydro.getAttitudes(), hydro.getDepths());
			System.err.println(georef.getBathyPoints().size());

			//			PppFile pppFile = NrcanPPP.fetchPPP(gnssBinaryFile);
			
			//Make sure pppFile contain positions
//			System.out.println("First position : "+ pppFile.getPositions().get(0).toString());
//			System.out.println("100e position  : "+ pppFile.getPositions().get(100));	
//			int pppSize = pppFile.getPositions().size()-1;
//			System.out.println("size  : "+pppSize);
//			System.out.println("Last position  : "+pppFile.getPositions().get(pppSize));

//			Test pppFile
//			GnssQualifier gnss = new GnssQualifier();
//			gnss.validate(pppFile);
//			if(gnss.isErsValid()) {
//				TODO: ERS georeferencing
//				System.err.println("POS File valid for ERS georeferencing" );
//			}
//			else {
//				if (gnss.isWlrsValid()) {
					//todo wlrs georeferencing
//					System.err.println("POS File valid for WLRS georeferencing only" );
//				}
//				else {
					//("POS File not valid, do nothing" );
//					System.err.println("POS File not valid for georeferencing" );

//				}
//			}
			
		}
		catch(Exception e) {
			System.err.println("Error while georeferencing: " + e.getMessage() );
		}
			

/*
		Georeferencing geo =new Georeferencing();
		geo.dcm(1.054, 4.25, 1.2458);
		
//		public void LatLonH_2_ECEF(double lat, double lon, double ellipsoidal_height, double half_ellipsoidal_axe, double first_eccentricity)
		geo.LatLonH_2_ECEF(46.86194, -4.470, 48.8, 6378137, 0.081819190842622);
*/		
		
		

	}
}
